<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LifeSquare Admin & Global Wall</title>
    <style>
        :root { --bg: #020617; --accent: #38bdf8; --gold: #facc15; }
        body { background: var(--bg); color: #fff; font-family: sans-serif; margin: 0; }
        
        /* لوحة التحكم المخفية */
        #adminPanel {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(2, 6, 23, 0.98); z-index: 10000; padding: 50px; box-sizing: border-box;
            overflow-y: auto;
        }
        .admin-card { background: #1e293b; padding: 20px; border-radius: 15px; margin-bottom: 20px; border: 1px solid var(--accent); }
        
        /* شكل المربعات */
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 10px; padding: 20px; }
        .square { aspect-ratio: 1; background: #0f172a; border: 1px solid #334155; border-radius: 8px; cursor: pointer; position: relative; overflow: hidden; }
        .square img { width: 100%; height: 100%; object-fit: cover; }
        
        .ad-box { background: #1e293b; height: 90px; margin: 20px; display: flex; align-items: center; justify-content: center; border: 1px dashed var(--accent); color: var(--accent); }
        h1 { cursor: pointer; text-align: center; font-size: 3rem; background: linear-gradient(to right, #38bdf8, #facc15); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    </style>
</head>
<body>

    <div class="ad-box" id="topAd">
        Google Ads Space (Top)
    </div>

    <h1 id="mainTitle" ondblclick="showLogin()">LifeSquare</h1>
    <p style="text-align: center;">Double click the title to access Admin Panel</p>

    <div class="grid" id="mainGrid"></div>

    <div id="adminPanel">
        <h1>Admin Control Center</h1>
        <div class="admin-card">
            <h3>Wall Settings</h3>
            <p>Total Squares: <input type="number" id="newSize" value="200"> <button onclick="changeGrid()">Update Size</button></p>
        </div>
        <div class="admin-card">
            <h3>Ad Management</h3>
            <p>Top Ad Status: <select onchange="toggleAd('topAd', this.value)"><option value="block">Show</option><option value="none">Hide</option></select></p>
            <p>Bottom Ad Status: <select onchange="toggleAd('bottomAd', this.value)"><option value="block">Show</option><option value="none">Hide</option></select></p>
        </div>
        <div class="admin-card">
            <h3>Stats</h3>
            <p>Total Memories: <span id="memCount">0</span></p>
        </div>
        <button onclick="document.getElementById('adminPanel').style.display='none'" style="background: red; color: white; padding: 15px; width: 100%; cursor: pointer;">Exit Admin Panel</button>
    </div>

    <div class="ad-box" id="bottomAd">
        Google Ads Space (Bottom)
    </div>

    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'
        const supabase = createClient("https://fnbdhcncujueyznrlmpi.supabase.co", "sb_publishable_wzpxcVJxxAIElNknL8hUHA_GCDzvcVR")
        
        let gridSize = 200;

        window.showLogin = () => {
            let pass = prompt("Enter Admin Password:");
            if(pass === "123") {
                document.getElementById('adminPanel').style.display = 'block';
                updateStats();
            } else { alert("Access Denied"); }
        }

        window.changeGrid = () => {
            gridSize = document.getElementById('newSize').value;
            loadWall();
            alert("Grid Updated!");
        }

        window.toggleAd = (id, val) => {
            document.getElementById(id).style.display = val;
        }

        async function updateStats() {
            const { count } = await supabase.from('memories').select('*', { count: 'exact', head: true });
            document.getElementById('memCount').innerText = count;
        }

        async function loadWall() {
            const grid = document.getElementById("mainGrid");
            grid.innerHTML = "";
            const { data } = await supabase.from("memories").select("*");
            const map = {}; data?.forEach(m => map[m.square_id] = m);

            for (let i = 0; i < gridSize; i++) {
                let sq = document.createElement("div");
                sq.className = "square";
                let m = map[i];
                if(m) {
                    if(m.image_url) sq.innerHTML = `<img src="${m.image_url}">`;
                    sq.onclick = () => alert("Memory by: " + m.name + "\nStory: " + m.story);
                } else {
                    sq.innerHTML = "<span style='opacity:0.2; font-size:20px; display:block; text-align:center; margin-top:30%;'>+</span>";
                }
                grid.appendChild(sq);
            }
        }

        loadWall();
    </script>
</body>
</html>

